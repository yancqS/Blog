(window.webpackJsonp=window.webpackJsonp||[]).push([[94],{705:function(e,t,a){"use strict";a.r(t);var s=a(6),n=Object(s.a)({},(function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("ContentSlotsDistributor",{attrs:{"slot-key":e.$parent.slotKey}},[a("h1",{attrs:{id:"how-javascript-works-memory-management-how-to-handle-4-common-memory-leaks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#how-javascript-works-memory-management-how-to-handle-4-common-memory-leaks"}},[e._v("#")]),e._v(" How JavaScript works: memory management + how to handle 4 common memory leaks")]),e._v(" "),a("blockquote",[a("p",[e._v("JavaScript工作原理：内存泄露 + 如何处理4中常见的内存泄露")])]),e._v(" "),a("h2",{attrs:{id:"overview"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#overview"}},[e._v("#")]),e._v(" Overview")]),e._v(" "),a("blockquote",[a("p",[e._v("概览")])]),e._v(" "),a("p",[e._v("Languages, like C, have low-level memory management primitives such as "),a("code",[e._v("malloc()")]),e._v(" and "),a("code",[e._v("free()")]),e._v(". These primitives are used by the developer to explicitly allocate and free memory from and to the operating system.")]),e._v(" "),a("blockquote"),e._v(" "),a("p",[e._v("At the same time, JavaScript allocates memory when things (objects, strings, etc.) are created and “automatically” frees it up when they are not used anymore, a process called garbage collection. This seemingly “automatical” nature of freeing up resources is a source of confusion and gives JavaScript (and other high-level-language) developers the false impression they can choose not to care about memory management. "),a("strong",[e._v("This is a big mistake")]),e._v(".")]),e._v(" "),a("p",[e._v("Even when working with high-level languages, developers should have an understanding of memory management (or at least the basics). Sometimes there are issues with the automatic memory management (such as bugs or implementation limitations in the garbage collectors, etc.) which developers have to understand in order to handle them properly (or to find a proper workaround, with a minimum trade off and code debt).")]),e._v(" "),a("h2",{attrs:{id:"memory-life-cycle"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#memory-life-cycle"}},[e._v("#")]),e._v(" Memory life cycle")]),e._v(" "),a("p",[e._v("No matter what programming language you’re using, memory life cycle is pretty much always the same:")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20210517122820.png",alt:""}})]),e._v(" "),a("p",[e._v("Here is an overview of what happens at each step of the cycle:")]),e._v(" "),a("ul",[a("li",[a("strong",[e._v("Allocate memory")]),e._v(" — memory is allocated by the operating system which allows your program to use it. In low-level languages (e.g. C) this is an explicit operation that you as a developer should handle. In high-level languages, however, this is taken care of for you.")]),e._v(" "),a("li",[a("strong",[e._v("Use memory")]),e._v(" — this is the time when your program actually makes use of the previously allocated memory. "),a("strong",[e._v("Read")]),e._v(" and "),a("strong",[e._v("write")]),e._v(" operations are taking place as you’re using the allocated variables in your code.")]),e._v(" "),a("li",[a("strong",[e._v("Release memory")]),e._v(" — now is the time to release the entire memory that you don’t need so that it can become free and available again. As with the "),a("strong",[e._v("Allocate memory")]),e._v(" operation, this one is explicit in low-level languages.")])]),e._v(" "),a("p",[e._v("For a quick overview of the concepts of the call stack and the memory heap, you can read our first post on the topic.")]),e._v(" "),a("h2",{attrs:{id:"what-is-memory"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-is-memory"}},[e._v("#")]),e._v(" What is memory?")]),e._v(" "),a("p",[e._v("Before jumping straight to memory in JavaScript, we’ll briefly discuss what memory is in general and how it works in a nutshell.")]),e._v(" "),a("p",[e._v("On a hardware level, computer memory consists of a large number of\nflip flops. Each flip flop contains a few transistors and is capable of storing one bit. Individual flip flops are addressable by a "),a("strong",[e._v("unique identifier")]),e._v(", so we can read and overwrite them. Thus, conceptually, we can think of our entire computer memory as a just one giant array of bits that we can read and write.")]),e._v(" "),a("p",[e._v("Since as humans, we are not that good at doing all of our thinking and arithmetic in bits, we organize them into larger groups, which together can be used to represent numbers. 8 bits are called 1 byte. Beyond bytes, there are words (which are sometimes 16, sometimes 32 bits).")]),e._v(" "),a("p",[e._v("A lot of things are stored in this memory:")]),e._v(" "),a("ol",[a("li",[e._v("All variables and other data used by all programs.")]),e._v(" "),a("li",[e._v("The programs’ code, including the operating system’s.")])]),e._v(" "),a("p",[e._v("The compiler and the operating system work together to take care of most of the memory management for you, but we recommend that you take a look at what’s going on under the hood.")]),e._v(" "),a("p",[e._v("When you compile your code, the compiler can examine primitive data types and calculate ahead of time how much memory they will need. The required amount is then allocated to the program in the call stack space. The space in which these variables are allocated is called the stack space because as functions get called, their memory gets added on top of the existing memory. As they terminate, they are removed in a LIFO (last-in, first-out) order. For example, consider the following declarations:")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[e._v("int n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 4 bytes")]),e._v("\nint x"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("4")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// array of 4 elements, each 4 bytes")]),e._v("\ndouble m"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 8 bytes")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("The compiler can immediately see that the code requires "),a("code",[e._v("4 + 4 × 4 + 8 = 28")]),e._v(" bytes.")]),e._v(" "),a("blockquote",[a("p",[a("em",[e._v("That’s how it works with the current sizes for integers and doubles. About 20 years ago, integers were typically 2 bytes, and double 4 bytes. Your code should never have to depend on what is at this moment the size of the basic data types.")])])]),e._v(" "),a("p",[e._v("The compiler will insert code that will interact with the operating system to request the necessary number of bytes on the stack for your variables to be stored.")]),e._v(" "),a("p",[e._v("In the example above, the compiler knows the exact memory address of each variable. In fact, whenever we write to the variable "),a("code",[e._v("n")]),e._v(", this gets translated into something like “memory address 4127963” internally.")]),e._v(" "),a("p",[e._v("Notice that if we attempted to access "),a("code",[e._v("x[4]")]),e._v(" here, we would have accessed the data associated with m . That’s because we’re accessing an element in the array that doesn’t exist — it’s 4 bytes further than the last actual allocated element in the array which is "),a("code",[e._v("x[3]")]),e._v(", and may end up reading (or overwriting) some of "),a("code",[e._v("m’")]),e._v("s bits. This would almost certainly have very undesired consequences for the rest of the program.")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20210517123823.png",alt:""}})]),e._v(" "),a("p",[e._v("When functions call other functions, each gets its own chunk of the stack when it is called. It keeps all its local variables there, but also a program counter that remembers where in its execution it was. When the function finishes, its memory block is once again made available for other purposes.")]),e._v(" "),a("h2",{attrs:{id:"dynamic-allocation"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#dynamic-allocation"}},[e._v("#")]),e._v(" Dynamic allocation")]),e._v(" "),a("p",[e._v("Unfortunately, things aren’t quite as easy when we don’t know at compile time how much memory a variable will need. Suppose we want to do something like the following:")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[e._v("int n "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("readInput")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// reads input from the user")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("...")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v('// create an array with "n" elements')]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("Here, at compile time, the compiler does not know how much memory the array will need because it is determined by the value provided by the user.")]),e._v(" "),a("p",[e._v("It, therefore, cannot allocate room for a variable on the stack. Instead, our program needs to explicitly ask the operating system for the right amount of space at run-time. This memory is assigned from the "),a("strong",[e._v("heap space")]),e._v(". The difference between static and dynamic memory allocation is summarized in the following table:")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20210517124022.png",alt:""}})]),e._v(" "),a("center",{staticStyle:{color:"#ccc"}},[e._v("Differences between statically and dynamically allocated memory")]),e._v(" "),a("p",[e._v("To fully understand how dynamic memory allocation works, we need to spend more time on "),a("strong",[e._v("pointers")]),e._v(", which might be a bit too much of a deviation from the topic of this post. If you’re interested in learning more, just let me know in the comments and we can go into more details about pointers in a future post.")]),e._v(" "),a("h2",{attrs:{id:"allocation-in-javascript"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#allocation-in-javascript"}},[e._v("#")]),e._v(" Allocation in JavaScript")]),e._v(" "),a("p",[e._v("Now we’ll explain how the first step (allocate memory) works in JavaScript.")]),e._v(" "),a("p",[e._v("JavaScript relieves developers from the responsibility to handle memory allocations — JavaScript does it by itself, alongside declaring values.")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" n "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("374")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// allocates memory for a number")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" s "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'sessionstack'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// allocates memory for a string ")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" o "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  a"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n  b"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("null")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// allocates memory for an object and its contained values")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'str'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("  "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// (like object) allocates memory for the")]),e._v("\n                           "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// array and its contained values")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("f")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("a")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("return")]),e._v(" a "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// allocates a function (which is a callable object)")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// function expressions also allocate an object")]),e._v("\nsomeElement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  someElement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("style"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("backgroundColor "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'blue'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token boolean"}},[e._v("false")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br")])]),a("p",[e._v("Some function calls result in object allocation as well:")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" d "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Date")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// allocates a Date object")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" e "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("createElement")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'div'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// allocates a DOM element")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("Methods can allocate new values or objects:")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" s1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'sessionstack'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" s2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" s1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("substr")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("3")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// s2 is a new string")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Since strings are immutable, ")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// JavaScript may decide to not allocate memory, ")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// but just store the [0, 3] range.")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" a1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'str1'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'str2'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" a2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("[")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'str3'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'str4'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("]")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" a3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" a1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("concat")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("a2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" \n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// new array with 4 elements being")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// the concatenation of a1 and a2 elements")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br")])]),a("h2",{attrs:{id:"using-memory-in-javascript"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#using-memory-in-javascript"}},[e._v("#")]),e._v(" Using memory in JavaScript")]),e._v(" "),a("p",[e._v("Using the allocated memory in JavaScript basically, means reading and writing in it.")]),e._v(" "),a("p",[e._v("This can be done by reading or writing the value of a variable or an object property or even passing an argument to a function.")]),e._v(" "),a("h2",{attrs:{id:"release-when-the-memory-is-not-needed-anymore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#release-when-the-memory-is-not-needed-anymore"}},[e._v("#")]),e._v(" Release when the memory is not needed anymore")]),e._v(" "),a("p",[e._v("Most of the memory management issues come at this stage.")]),e._v(" "),a("p",[e._v("The hardest task here is to figure out when the allocated memory is not needed any longer. It often requires the developer to determine where in the program such piece of memory is not needed anymore and free it.")]),e._v(" "),a("p",[e._v("High-level languages embed a piece of software called "),a("strong",[e._v("garbage collector")]),e._v(" which job is to track memory allocation and use in order to find when a piece of allocated memory is not needed any longer in which case, it will automatically free it.")]),e._v(" "),a("p",[e._v("Unfortunately, this process is an approximation since the general problem of knowing whether some piece of memory is needed is undecidable (can’t be solved by an algorithm).")]),e._v(" "),a("p",[e._v("Most garbage collectors work by collecting memory which can no longer be accessed, e.g. all variables pointing to it went out of scope. That’s, however, an under-approximation of the set of memory spaces that can be collected, because at any point a memory location may still have a variable pointing to it in scope, yet it will never be accessed again.")]),e._v(" "),a("h2",{attrs:{id:"garbage-collection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#garbage-collection"}},[e._v("#")]),e._v(" Garbage collection")]),e._v(" "),a("p",[e._v("Due to the fact that finding whether some memory is “not needed anymore” is undecidable, garbage collections implement a restriction of a solution to the general problem. This section will explain the necessary notions to understand the main garbage collection algorithms and their limitations.")]),e._v(" "),a("h2",{attrs:{id:"memory-references"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#memory-references"}},[e._v("#")]),e._v(" Memory references")]),e._v(" "),a("p",[e._v("The main concept garbage collection algorithms rely on is the one of reference.")]),e._v(" "),a("p",[e._v("Within the context of memory management, an object is said to reference another object if the former has an access to the latter (can be implicit or explicit). For instance, a JavaScript object has a reference to its "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Guide/Inheritance_and_the_prototype_chain",target:"_blank",rel:"noopener noreferrer"}},[e._v("prototype"),a("OutboundLink")],1),e._v(" (implicit reference) and to its properties’ values ("),a("strong",[e._v("explicit reference")]),e._v(").")]),e._v(" "),a("p",[e._v("In this context, the idea of an “object” is extended to something broader than regular JavaScript objects and also contains function scopes (or the global "),a("strong",[e._v("lexical scope")]),e._v(").")]),e._v(" "),a("blockquote",[a("p",[a("em",[e._v("Lexical Scoping defines how variable names are resolved in nested functions: inner functions contain the scope of parent functions even if the parent function has returned.")])])]),e._v(" "),a("h2",{attrs:{id:"reference-counting-garbage-collection"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#reference-counting-garbage-collection"}},[e._v("#")]),e._v(" Reference-counting garbage collection")]),e._v(" "),a("p",[e._v("This is the simplest garbage collection algorithm. An object is considered “garbage collectible” if there are zero references pointing to it.")]),e._v(" "),a("p",[e._v("Take a look at the following code:")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" o1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  o2"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    x"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 2 objects are created. ")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 'o2' is referenced by 'o1' object as one of its properties.")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// None can be garbage-collected")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" o3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" o1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// the 'o3' variable is the second thing that ")]),e._v("\n             "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// has a reference to the object pointed by 'o1'. ")]),e._v("\n                                                       \no1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("      "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// now, the object that was originally in 'o1' has a         ")]),e._v("\n             "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// single reference, embodied by the 'o3' variable")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" o4 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" o3"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("o2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// reference to 'o2' property of the object.")]),e._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// This object has now 2 references: one as")]),e._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// a property. ")]),e._v("\n                "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The other as the 'o4' variable")]),e._v("\n\no3 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'374'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The object that was originally in 'o1' has now zero")]),e._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// references to it. ")]),e._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// It can be garbage-collected.")]),e._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// However, what was its 'o2' property is still")]),e._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// referenced by the 'o4' variable, so it cannot be")]),e._v("\n            "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// freed.")]),e._v("\n\no4 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// what was the 'o2' property of the object originally in")]),e._v("\n           "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// 'o1' has zero references to it. ")]),e._v("\n           "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// It can be garbage collected.")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br"),a("span",{staticClass:"line-number"},[e._v("18")]),a("br"),a("span",{staticClass:"line-number"},[e._v("19")]),a("br"),a("span",{staticClass:"line-number"},[e._v("20")]),a("br"),a("span",{staticClass:"line-number"},[e._v("21")]),a("br"),a("span",{staticClass:"line-number"},[e._v("22")]),a("br"),a("span",{staticClass:"line-number"},[e._v("23")]),a("br"),a("span",{staticClass:"line-number"},[e._v("24")]),a("br"),a("span",{staticClass:"line-number"},[e._v("25")]),a("br"),a("span",{staticClass:"line-number"},[e._v("26")]),a("br"),a("span",{staticClass:"line-number"},[e._v("27")]),a("br"),a("span",{staticClass:"line-number"},[e._v("28")]),a("br"),a("span",{staticClass:"line-number"},[e._v("29")]),a("br"),a("span",{staticClass:"line-number"},[e._v("30")]),a("br")])]),a("h2",{attrs:{id:"cycles-are-creating-problems"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cycles-are-creating-problems"}},[e._v("#")]),e._v(" Cycles are creating problems")]),e._v(" "),a("p",[e._v("There is a limitation when it comes to cycles. In the following example, two objects are created and reference one another, thus creating a cycle. They will go out of scope after the function call, so they are effectively useless and could be freed. However, the reference-counting algorithm considers that since each of the two objects is referenced at least once, neither can be garbage-collected.")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("f")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" o1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" o2 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  o1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("p "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" o2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// o1 references o2")]),e._v("\n  o2"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("p "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" o1"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// o2 references o1. This creates a cycle.")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("f")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br")])]),a("p",[a("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20210517164222.png",alt:""}})]),e._v(" "),a("h2",{attrs:{id:"mark-and-sweep-algorithm"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#mark-and-sweep-algorithm"}},[e._v("#")]),e._v(" Mark-and-sweep algorithm")]),e._v(" "),a("p",[e._v("In order to decide whether an object is needed, this algorithm determines whether the object is reachable.")]),e._v(" "),a("p",[e._v("The Mark-and-sweep algorithm goes through these 3 steps:")]),e._v(" "),a("ol",[a("li",[e._v("Roots: In general, roots are global variables which get referenced in the code. In JavaScript for example, a global variable that can act as a root is the “window” object. The identical object in Node.js is called “global”. A complete list of all roots gets built by the garbage collector.")]),e._v(" "),a("li",[e._v("The algorithm then inspects all roots and their children and marks them as active (meaning, they are not garbage). Anything that a root cannot reach will be marked as garbage.")]),e._v(" "),a("li",[e._v("Finally, the garbage collector frees all memory pieces that are not marked as active and returns that memory to the OS.")])]),e._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20210517164445.gif",alt:""}})]),e._v(" "),a("center",{staticStyle:{color:"#ccc"}},[e._v("A visualization of the mark and sweep algorithm in action")]),e._v(" "),a("p",[e._v("This algorithm is better than the previous one since “an object has zero reference” leads to this object being unreachable. The opposite is not true as we have seen with cycles.")]),e._v(" "),a("p",[e._v("As of 2012, all modern browsers ship a mark-and-sweep garbage-collector. All improvements made in the field of JavaScript garbage collection (generational/incremental/concurrent/parallel garbage collection) over the last years are implementation improvements of this algorithm (mark-and-sweep), but not improvements over the garbage collection algorithm itself, nor its goal of deciding whether an object is reachable or not.")]),e._v(" "),a("p",[e._v("In this article, you can read in a greater detail about tracing garbage collection that also covers mark-and-sweep along with its optimizations.")]),e._v(" "),a("h2",{attrs:{id:"cycles-are-not-a-problem-anymore"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#cycles-are-not-a-problem-anymore"}},[e._v("#")]),e._v(" Cycles are not a problem anymore")]),e._v(" "),a("p",[e._v("In the first example above, after the function call returns, the two objects are not referenced anymore by something reachable from the global object. Consequently, they will be found unreachable by the garbage collector.")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20210517165406.png",alt:""}})]),e._v(" "),a("p",[e._v("Even though there are references between the objects, they’re not reachable from the root.")]),e._v(" "),a("h2",{attrs:{id:"counter-intuitive-behavior-of-garbage-collectors"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#counter-intuitive-behavior-of-garbage-collectors"}},[e._v("#")]),e._v(" Counter intuitive behavior of Garbage Collectors")]),e._v(" "),a("p",[e._v("Although Garbage Collectors are convenient they come with their own set of trade-offs. One of them is non-determinism. In other words, GCs are unpredictable. You can’t really tell when a collection will be performed. This means that in some cases programs use more memory that it’s actually required. In other cases, short-pauses may be noticeable in particularly sensitive applications. Although non-determinism means one cannot be certain when a collection will be performed, most GC implementations share the common pattern of doing collection passes during allocation. If no allocations are performed, most GCs stay idle. Consider the following scenario:")]),e._v(" "),a("ol",[a("li",[e._v("A sizable set of allocations is performed.")]),e._v(" "),a("li",[e._v("Most of these elements (or all of them) are marked as unreachable (suppose we null a reference pointing to a cache we no longer need).")]),e._v(" "),a("li",[e._v("No further allocations are performed.")])]),e._v(" "),a("p",[e._v("In this scenario, most GCs will not run any further collection passes. In other words, even though there are unreachable references available for collection, these are not claimed by the collector. These are not strictly leaks but still, result in higher-than-usual memory usage.")]),e._v(" "),a("h2",{attrs:{id:"what-are-memory-leaks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#what-are-memory-leaks"}},[e._v("#")]),e._v(" What are memory leaks?")]),e._v(" "),a("p",[e._v("Just like the memory suggests, memory leaks are pieces of memory that the application have used in the past but is not needed any longer but has not yet been return back to the OS or the pool of free memory.")]),e._v(" "),a("p",[a("img",{attrs:{src:"https://gitee.com/yancqS/blogImage/raw/master/blogImage/20210517170426.jpeg",alt:""}})]),e._v(" "),a("p",[e._v("Programming languages favor different ways of managing memory. However, whether a certain piece of memory is used or not is actually an "),a("a",{attrs:{href:"https://developer.mozilla.org/en-US/docs/Web/JavaScript/Memory_Management#release_when_the_memory_is_not_needed_anymore",target:"_blank",rel:"noopener noreferrer"}},[e._v("undecidable problem"),a("OutboundLink")],1),e._v(". In other words, only developers can make it clear whether a piece of memory can be returned to the operating system or not.")]),e._v(" "),a("p",[e._v("Certain programming languages provide features that help developers do this. Others expect developers to be completely explicit about when a piece of memory is unused. Wikipedia has good articles on manual and automatic memory management.")]),e._v(" "),a("h2",{attrs:{id:"the-four-types-of-common-javascript-leaks"}},[a("a",{staticClass:"header-anchor",attrs:{href:"#the-four-types-of-common-javascript-leaks"}},[e._v("#")]),e._v(" The four types of common JavaScript leaks")]),e._v(" "),a("ol",[a("li",[e._v("Global variables")])]),e._v(" "),a("p",[e._v("JavaScript handles undeclared variables in an interesting way: when a undeclared variable is referenced, a new variable gets created in the global object. In a browser, the global object would be window, which means that")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("arg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    bar "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"some text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("is the equivalent of:")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("arg")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    window"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("bar "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"some text"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br")])]),a("p",[e._v("Let’s say the purpose of "),a("code",[e._v("bar")]),e._v(" is to only reference a variable in the foo function. A redundant global variable will be created, however, if you don’t use "),a("code",[e._v("var")]),e._v(" to declare it. In the above case, this won’t cause much harm. You can surely imagine a more damaging scenario though.")]),e._v(" "),a("p",[e._v("You can also accidentally create a global variable using "),a("code",[e._v("this")]),e._v(":")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("this")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("var1 "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"potential accidental global"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Foo called on its own, this points to the global object (window)")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// rather than being undefined.")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("foo")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("blockquote",[a("p",[a("em",[e._v("You can avoid all this by adding "),a("code",[e._v("‘use strict’;")]),e._v(" at the beginning of your JavaScript file which would switch on a much stricter mode of parsing JavaScript which prevents the unexpected creation of global variables.")])])]),e._v(" "),a("p",[e._v("Unexpected globals is certainly an issue, however, more often than not your code would be infested with explicit global variables which by definition cannot be collected by the garbage collector. Special attention needs to be given to global variables used to temporarily store and process large bits of information. Use global variables to store data if you must but when you do, make sure to "),a("strong",[e._v("assign it as null or reassign it")]),e._v(" once you are done with it.")]),e._v(" "),a("ol",{attrs:{start:"2"}},[a("li",[e._v("Timers or callbacks that are forgotten")])]),e._v(" "),a("p",[e._v("Let’s take "),a("code",[e._v("setInterval")]),e._v(" for example as it’s often used in JavaScript.")]),e._v(" "),a("p",[e._v("Libraries which provide observers and other instruments that accept callbacks usually make sure all references to the callbacks become unreachable once their instances are unreachable too. Still, the code below is not a rare find:")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" serverData "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("loadData")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("setInterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" renderer "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'renderer'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("renderer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n        renderer"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("innerHTML "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token constant"}},[e._v("JSON")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("stringify")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("serverData"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("5000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//This will be executed every ~5 seconds.")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br")])]),a("p",[e._v("The snippet above shows the consequences of using timers that reference nodes or data that’s no longer needed.")]),e._v(" "),a("p",[e._v("The renderer object may be replaced or removed at some point which would make the block encapsulated by the interval handler redundant. If this happens, neither the handler, nor its dependencies would be collected as the interval would need to be stopped first (remember, it’s still active). It all boils down to the fact that "),a("code",[e._v("serverData")]),e._v(" which surely stores and processes loads of data will not be collected either.")]),e._v(" "),a("p",[e._v("When using observers, you need to make sure you make an explicit call to remove them once you are done with them (either the observer is not needed anymore, or the object will become unreachable).")]),e._v(" "),a("p",[e._v("Luckily, most modern browsers would do the job for you: they’ll automatically collect the observer handlers once the observed object becomes unreachable even if you forgot to remove the listener. In the past some browsers were unable to handle these cases (good old IE6).")]),e._v(" "),a("p",[e._v("Still, though, it’s in line with best practices to remove the observers once the object becomes obsolete. See the following example:")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" element "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'launch-button'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" counter "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("0")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("onClick")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token parameter"}},[e._v("event")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n   counter"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("++")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n   element"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("innerHtml "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'text '")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("+")]),e._v(" counter"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\nelement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("addEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" onClick"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Do stuff")]),e._v("\n\nelement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("removeEventListener")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'click'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" onClick"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\nelement"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("parentNode"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("removeChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("element"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// Now when element goes out of scope,")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// both element and onClick will be collected even in old browsers // that don't handle cycles well.")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br")])]),a("p",[e._v("You no longer need to call "),a("code",[e._v("removeEventListener")]),e._v(" before making a node unreachable as modern browsers support garbage collectors that can detect these cycles and handle them appropriately.")]),e._v(" "),a("p",[e._v("If you leverage the "),a("code",[e._v("jQuery")]),e._v(" APIs (other libraries and frameworks support this too) you can also have the listeners removed before a node is made obsolete. The library would also make sure there are no memory leaks even when the application is running under older browser versions.")]),e._v(" "),a("ol",{attrs:{start:"3"}},[a("li",[e._v("Closures")])]),e._v(" "),a("p",[e._v("A key aspect of JavaScript development are closures: an inner function that has access to the outer (enclosing) function’s variables. Due to the implementation details of the JavaScript runtime, it is possible to leak memory in the following way:")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" theThing "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("null")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[e._v("replaceThing")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" originalThing "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" theThing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[e._v("unused")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("if")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("originalThing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// a reference to 'originalThing'")]),e._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"hi"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n  theThing "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    longStr"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("new")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token class-name"}},[e._v("Array")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1000000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("join")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'*'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token function-variable function"}},[e._v("someMethod")]),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n      console"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("log")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v('"message"')]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n  "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("setInterval")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("replaceThing"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token number"}},[e._v("1000")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br")])]),a("p",[e._v("Once "),a("code",[e._v("replaceThing")]),e._v(" is called, "),a("code",[e._v("theThing")]),e._v(" gets a new object which consists of a big array and a new closure ("),a("code",[e._v("someMethod")]),e._v("). Yet, "),a("code",[e._v("originalThing")]),e._v(" is referenced by a closure that’s held by the "),a("code",[e._v("unused")]),e._v(" variable (which is "),a("code",[e._v("theThing")]),e._v(" variable from the previous call to "),a("code",[e._v("replaceThing")]),e._v("). The thing to remember is that "),a("strong",[e._v("once a scope for closures is created for closures in the same parent scope, the scope is shared")]),e._v(".")]),e._v(" "),a("p",[e._v("In this case, the scope created for the closure "),a("code",[e._v("someMethod")]),e._v(" is shared with unused. "),a("code",[e._v("unused")]),e._v(" has a reference to "),a("code",[e._v("originalThing")]),e._v(". Even though "),a("code",[e._v("unused")]),e._v(" is never used, "),a("code",[e._v("someMethod")]),e._v(" can be used through "),a("code",[e._v("theThing")]),e._v(" outside of the scope of "),a("code",[e._v("replaceThing")]),e._v(" (e.g. somewhere globally). And as "),a("code",[e._v("someMethod")]),e._v(" shares the closure scope with "),a("code",[e._v("unused")]),e._v(", the reference "),a("code",[e._v("unused")]),e._v(" has to "),a("code",[e._v("originalThing")]),e._v(" forces it to stay active (the whole shared scope between the two closures). This prevents its collection.")]),e._v(" "),a("p",[e._v("In the above example, the scope created for the closure "),a("code",[e._v("someMethod")]),e._v(" is shared with "),a("code",[e._v("unused")]),e._v(", while "),a("code",[e._v("unused")]),e._v(" references "),a("code",[e._v("originalThing")]),e._v(". "),a("code",[e._v("someMethod")]),e._v(" can be used through "),a("code",[e._v("theThing")]),e._v(" outside of the "),a("code",[e._v("replaceThing")]),e._v(" scope, despite the fact that unused is never used. The fact that unused references originalThing requires that it remains active since "),a("code",[e._v("someMethod")]),e._v(" shares the closure scope with unused.")]),e._v(" "),a("p",[e._v("All this can result in a considerable memory leak. You can expect to see a spike in memory usage when the above snippet is run over and over again. Its size won’t shrink when the garbage collector runs. A linked list of closures is created (its root is "),a("code",[e._v("theThing")]),e._v(" variable in this case), and each the closure scopes carries forward an indirect reference to the big array.")]),e._v(" "),a("p",[e._v("This issue was found by the Meteor team and "),a("a",{attrs:{href:"https://blog.meteor.com/an-interesting-kind-of-javascript-memory-leak-8b47d2e7f156",target:"_blank",rel:"noopener noreferrer"}},[e._v("they have a great article"),a("OutboundLink")],1),e._v(" that describes the issue in great detail.")]),e._v(" "),a("ol",{attrs:{start:"4"}},[a("li",[e._v("Out of DOM references")])]),e._v(" "),a("p",[e._v("There are cases in which developers store DOM nodes inside data structures. Suppose you want to rapidly update the contents of several rows in a table. If you store a reference to each DOM row in a dictionary or an array, there will be two references to the same DOM element: one in the DOM tree and another in the dictionary. If you decide to get rid of these rows, you need to remember to make both references unreachable.")]),e._v(" "),a("div",{staticClass:"language-js line-numbers-mode"},[a("pre",{pre:!0,attrs:{class:"language-js"}},[a("code",[a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("var")]),e._v(" elements "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    button"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'button'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(",")]),e._v("\n    image"),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v(":")]),e._v(" document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'image'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("doStuff")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    elements"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("image"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("src "),a("span",{pre:!0,attrs:{class:"token operator"}},[e._v("=")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'http://example.com/image_name.png'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n\n"),a("span",{pre:!0,attrs:{class:"token keyword"}},[e._v("function")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("removeImage")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),e._v(" "),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("{")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// The image is a direct child of the body element.")]),e._v("\n    document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),e._v("body"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("removeChild")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),e._v("document"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(".")]),a("span",{pre:!0,attrs:{class:"token function"}},[e._v("getElementById")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("(")]),a("span",{pre:!0,attrs:{class:"token string"}},[e._v("'image'")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(")")]),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v(";")]),e._v("\n    \n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("// At this point, we still have a reference to #button in the")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//global elements object. In other words, the button element is")]),e._v("\n    "),a("span",{pre:!0,attrs:{class:"token comment"}},[e._v("//still in memory and cannot be collected by the GC.")]),e._v("\n"),a("span",{pre:!0,attrs:{class:"token punctuation"}},[e._v("}")]),e._v("\n")])]),e._v(" "),a("div",{staticClass:"line-numbers-wrapper"},[a("span",{staticClass:"line-number"},[e._v("1")]),a("br"),a("span",{staticClass:"line-number"},[e._v("2")]),a("br"),a("span",{staticClass:"line-number"},[e._v("3")]),a("br"),a("span",{staticClass:"line-number"},[e._v("4")]),a("br"),a("span",{staticClass:"line-number"},[e._v("5")]),a("br"),a("span",{staticClass:"line-number"},[e._v("6")]),a("br"),a("span",{staticClass:"line-number"},[e._v("7")]),a("br"),a("span",{staticClass:"line-number"},[e._v("8")]),a("br"),a("span",{staticClass:"line-number"},[e._v("9")]),a("br"),a("span",{staticClass:"line-number"},[e._v("10")]),a("br"),a("span",{staticClass:"line-number"},[e._v("11")]),a("br"),a("span",{staticClass:"line-number"},[e._v("12")]),a("br"),a("span",{staticClass:"line-number"},[e._v("13")]),a("br"),a("span",{staticClass:"line-number"},[e._v("14")]),a("br"),a("span",{staticClass:"line-number"},[e._v("15")]),a("br"),a("span",{staticClass:"line-number"},[e._v("16")]),a("br"),a("span",{staticClass:"line-number"},[e._v("17")]),a("br")])]),a("p",[e._v("There’s an additional consideration that has to be taken into account when it comes to references to inner or leaf nodes inside a DOM tree. If you keep a reference to a table cell (a "),a("code",[e._v("<td>")]),e._v(" tag) in your code and decide to remove the table from the DOM yet keep the reference to that particular cell, you can expect a major memory leak to follow. You might think that the garbage collector would free up everything but that cell. This will not be the case, however. Since the cell is a child node of the table and children keep references to their parents, "),a("strong",[e._v("this single reference to the table cell would keep the whole table in memory")]),e._v(".")]),e._v(" "),a("comment")],1)}),[],!1,null,null,null);t.default=n.exports}}]);